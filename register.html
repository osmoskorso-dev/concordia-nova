<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kayıt Ol / Giriş Yap - Concordia Nova</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: Arial, sans-serif;
  background: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1950&q=80')
    no-repeat center center fixed;
  background-size: cover;
  color: #fff;
}

.container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
}

.box {
  background: rgba(0,0,0,0.65);
  padding: 30px;
  border-radius: 14px;
  width: 340px;
  text-align: center;
  box-shadow: 0 0 30px rgba(0,0,0,.6);
}

.box h2 {
  margin-bottom: 20px;
}

.box label {
  display: block;
  margin-top: 10px;
  font-weight: bold;
  text-align: left;
}

.box input {
  width: 100%;
  padding: 9px;
  margin-top: 5px;
  border-radius: 7px;
  border: none;
  background: rgba(255,255,255,0.12);
  color: #fff;
}

.box button {
  width: 100%;
  margin-top: 15px;
  padding: 11px;
  border: none;
  border-radius: 9px;
  font-weight: bold;
  cursor: pointer;
}

.primary-btn {
  background: #1DA1F2;
  color: #fff;
}

.primary-btn:hover {
  background: #0d8ddb;
}

.fb-btn {
  background: #1877f2;
  color: #fff;
}

.fb-btn:hover {
  background: #0f5dc1;
}

.toggle-btn {
  background: transparent;
  border: 1px solid #fff;
  color: #fff;
}

.toggle-btn:hover {
  background: rgba(255,255,255,0.15);
}

.muted {
  color:#ccc;
  font-size:13px;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="container">

  <!-- REGISTER -->
  <div class="box" id="registerBox">
    <h2>Kayıt Ol</h2>

    <label>Ad Soyad</label>
    <input type="text" id="fullName" placeholder="Ad Soyad">

    <label>Kullanıcı Adı</label>
    <input type="text" id="username" placeholder="kullaniciadi">

    <label>E-posta</label>
    <input type="email" id="email" placeholder="email@mail.com">

    <label>Şifre</label>
    <input type="password" id="password" placeholder="******">

    <button class="primary-btn" id="registerBtn">Kayıt Ol</button>
    <button class="toggle-btn" id="toLoginBtn">Zaten hesabın var mı?</button>

    <div class="muted">Kayıt sonrası otomatik profile yönlendirilirsin.</div>
  </div>

  <!-- LOGIN -->
  <div class="box" id="loginBox" style="display:none;">
    <h2>Giriş Yap</h2>

    <label>E-posta</label>
    <input type="email" id="loginEmail">

    <label>Şifre</label>
    <input type="password" id="loginPassword">

    <button class="primary-btn" id="loginBtn">Giriş Yap</button>
    <button class="fb-btn" id="fbLoginBtn">Facebook ile Giriş Yap</button>
    <button class="toggle-btn" id="toRegisterBtn">Hesabın yok mu?</button>

    <div class="muted">Facebook ile tek tık giriş yapabilirsin.</div>
  </div>

</div>

<!-- SUPABASE -->
<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

/* ===== SUPABASE CONFIG ===== */
const SUPABASE_URL = 'https://shkttorkfcnvkrwnkixf.supabase.co';
const SUPABASE_ANON_KEY = 'SENIN_ANON_KEYIN'; // anon public key
/* ========================== */

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ELEMENTS */
const registerBox = document.getElementById('registerBox');
const loginBox = document.getElementById('loginBox');

document.getElementById('toLoginBtn').onclick = toggleBox;
document.getElementById('toRegisterBtn').onclick = toggleBox;
document.getElementById('registerBtn').onclick = registerUser;
document.getElementById('loginBtn').onclick = loginUser;
document.getElementById('fbLoginBtn').onclick = loginWithFacebook;

function toggleBox(){
  registerBox.style.display =
    registerBox.style.display === 'none' ? 'block' : 'none';
  loginBox.style.display =
    loginBox.style.display === 'none' ? 'block' : 'none';
}

/* ================= REGISTER ================= */
async function registerUser(){
  const fullName = fullName.value.trim();
  const username = document.getElementById('username').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();

  if(!fullName || !username || !email || !password){
    alert('Tüm alanları doldur');
    return;
  }

  const { data, error } = await supabase.auth.signUp({ email, password });
  if(error){ alert(error.message); return; }

  await supabase.from('profiles').insert({
    id: data.user.id,
    username,
    display_name: fullName
  });

  location.href = 'profile.html';
}

/* ================= LOGIN ================= */
async function loginUser(){
  const email = loginEmail.value.trim();
  const password = loginPassword.value.trim();

  const { error } = await supabase.auth.signInWithPassword({ email, password });
  if(error){ alert(error.message); return; }

  location.href = 'profile.html';
}

/* ============== FACEBOOK LOGIN ============== */
async function loginWithFacebook(){
  await supabase.auth.signInWithOAuth({
    provider: 'facebook',
    options: {
      redirectTo: window.location.origin + '/profile.html'
    }
  });
}

/* ============ SESSION CHECK ============ */
const { data } = await supabase.auth.getUser();
if(data?.user){
  location.href = 'profile.html';
}

/* AUTH STATE LISTENER */
supabase.auth.onAuthStateChange((event) => {
  if(event === 'SIGNED_IN'){
    location.href = 'profile.html';
  }
});
</script>
</body>
</html>
